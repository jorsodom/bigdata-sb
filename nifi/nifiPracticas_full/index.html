
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jorsodom.github.io/bigdata-sb/nifi/nifiPracticas_full/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>NiFi Prácticas - CES Big Data</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nifi-practicas" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="CES Big Data" class="md-header__button md-logo" aria-label="CES Big Data" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CES Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              NiFi Prácticas
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CES Big Data" class="md-nav__button md-logo" aria-label="CES Big Data" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CES Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/presentacions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Presentación
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UD1. Introducción
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            UD1. Introducción
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/BIIntroduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción BI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/analitica/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Análisis de datos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/ETLintroduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción ETL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/tiposdedatos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tipos datos
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UD2. Entornos y modelado
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            UD2. Entornos y modelado
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multidimensional/entornos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tipos de entornos y arquitecturas de datos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multidimensional/multidimensional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modelo multidimensional (OLAP)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#practica-1-mover-un-fichero-de-un-origen-a-un-destino" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 1: Mover un fichero de un origen a un destino
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-2-atributos-y-contenido" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 2: Atributos y contenido
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-3-expression-language" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 3: Expression Language
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-4-process-group-input-output-port" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 4: Process group, Input-Output port
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-5-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 5: Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-6-funnel" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 6: Funnel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-7-controller-services" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 7: Controller Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-8-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Práctica 8: Variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-de-uso-con-api" class="md-nav__link">
    <span class="md-ellipsis">
      Caso de uso con API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-de-uso-con-postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      Caso de uso con PostgreSQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-de-uso-con-mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      Caso de uso con MongoDB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-de-uso-con-hadoop" class="md-nav__link">
    <span class="md-ellipsis">
      Caso de uso con Hadoop
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="nifi-practicas">NiFi Prácticas</h1>
<p><img src="https://nifi.apache.org/images/apache-nifi-drop-logo.svg" alt="NiFi" style="width:100px;height:100px;" ></p>
<h2 id="practica-1-mover-un-fichero-de-un-origen-a-un-destino">Práctica 1: Mover un fichero de un origen a un destino</h2>
<p><strong>Iniciamos</strong> NiFi. Ejecutamos:</p>
<div class="language-text highlight"><pre><span></span><code>    ./bin/nifi.sh start (Unix)
    ./bin/nifi.bat start (MSDOS)
</code></pre></div>
<p><strong>Accedemos</strong> a la siguiente url que se levantará en el ordenador (<em>o la que indica el 
Readme, según la versión funcionara una u otra</em>): </p>
<p><a href="https://localhost:8443/nifi/">https://localhost:8443/nifi/</a></p>
<p><img alt="NiFi" src="img\NiFiP1.1.png" />  </p>
<p><strong>Pedirá unas credenciales</strong>. Podemos utilizar las creadas de manera automática 
al arrancar por primera vez en el fichero de logs que podréis encontrar en: <em>logs/nifiapp.log</em>. Lo encontrareis buscando la siguiente palabra clave: <em>Username</em></p>
<p>Una vez hayamos hecho login, nos aparecerá la interfaz de trabajo.</p>
<p><img alt="NiFi" src="img\NiFiP1.2.png" />  </p>
<p>En la <strong>barra de iconos de herramientas</strong>, hacemos clic en “<em>Processor</em>” y arrastramos 
hacia el área de trabajo</p>
<p><img alt="NiFi" src="img\NiFiP1.3.png" /> </p>
<p>En la ventana de “<em>Add Processor</em>” búscamos <em>getFile</em>. Y hacemos clic en “<em>Add</em>”.</p>
<p><img alt="NiFi" src="img\NiFiP1.4.png" /> </p>
<p>Repetimos el mismo proceso para añadir el processor “<em>putFile</em>”. Quedando algo similar 
a la siguiente imagen.</p>
<p><img alt="NiFi" src="img\NiFiP1.5.png" /> </p>
<p>Ahora, vamos a <strong>configurar</strong> de dónde vamos a coger el fichero <em>origen</em> y dónde lo vamos 
a dejar en el <em>destino</em>. </p>
<p><strong>Hacemos clic</strong> botón derecho en “<em>GetFile</em>” en “<em>Configure</em>” y vamos a la pestaña 
“<em>Properties</em>”. Dónde podemos ver los diferentes aspectos que son configurables. 
Ahora mismo sólo vamos a indicar el directorio de entrada “<em>Input Directory</em>”.</p>
<p><img alt="NiFi" src="img\NiFiP1.6.png" /> </p>
<p>Hacemos clic botón derecho en “<em>PutFile</em>” en “<em>Configure</em>” y vamos a la pestaña 
“<em>Properties</em>”. Dónde podemos ver los diferentes aspectos que son configurables. 
Ahora mismo sólo vamos a indicar el directorio de entrada “<em>Directory</em>”.</p>
<p><img alt="NiFi" src="img\NiFiP1.7.png" /> </p>
<p>Ya configurado el componente del origen de los ficheros y el destino, sólo nos queda 
unirlos. Si hacemos clic sobre el componente “<em>GetFile</em>” veremos una flecha que nos 
permitirá arrastrarla hasta el otro componente “<em>PutFile</em>”. Quedando como la siguiente 
imagen:</p>
<p><img alt="NiFi" src="img\NiFiP1.8.png" /> </p>
<p>Ahora nos queda probar que traslada correctamente los ficheros, arrancando los dos 
componentes con botón derecho y hacer clic en “<em>Start</em>”. En los dos componentes. 
Primero el “<em>GetFile</em>” y luego el “<em>PutFile</em>”.</p>
<p><img alt="NiFi" src="img\NiFiP1.9.png" /> </p>
<p>Si al realizar la acción no sale la opción en el “<em>PutFile</em>” lo que hay que hacer es entrar 
en este componente en propiedades e indicarle que acción debe hacer en el caso de 
que falle</p>
<p><img alt="NiFi" src="img\NiFiP1.10.png" /> </p>
<p>Una vez todo configurado y en estado “<em>Start</em>” veréis que empieza a mover el fichero 
del origen configurado al destino. Marcado con verde como que se ha ejecutado 
correctamente</p>
<p><img alt="NiFi" src="img\NiFiP1.11.png" /> </p>
<p><strong>ENTREGABLE:</strong> Hay que exportar el template del proyecto y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P1_NomAlumnoApellidos.xml</em></p>
<h2 id="practica-2-atributos-y-contenido">Práctica 2: Atributos y contenido</h2>
<p>Generaremos primero un fichero aleatorio o con contenido personalizado, le aplicaremos 
alguna transformación y luego alteraremos en este sus propiedades. También veremos por los 
diferentes estados que pasa la ejecución y cómo ver en cada punto como va evolucionando el 
proceso.</p>
<p>Una vez hayamos hecho login, nos aparecerá la interfaz de trabajo</p>
<p><img alt="NiFi" src="img/NiFiP2.1.png" /> </p>
<p>En la barra de iconos de herramientas, hacemos clic en “<em>Processor</em>” y arrastramos 
hacia el área de trabajo.</p>
<p><img alt="NiFi" src="img/NiFiP2.2.png" /> </p>
<p>En la ventana de “<em>Add Processor</em>” búscamos “<em>GenerateFlowFile</em>”. Y hacemos clic en 
“<em>Add</em>”.</p>
<p>Nota: Este processor crea FlowFiles con datos aleatorios o contenido personalizado</p>
<p><img alt="NiFi" src="img/NiFiP2.3.png" /> </p>
<p>Ahora, vamos a configurarlo con datos aleatorios conforme la siguiente imagen. Y 
planificarlo.</p>
<p><img alt="NiFi" src="img/NiFiP2.4.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP2.5.png" /> </p>
<p>Ahora vamos a añadir a la hoja de trabajo, otro processor llamado “<em>Replace Text 
Processor</em>”</p>
<p>Nota: bajo cada processor encontraremos una breve descripción de la funcionalidad</p>
<p><img alt="NiFi" src="img/NiFiP2.6.png" /> </p>
<p>Establecemos la conexión entre los dos processor antes de configurar el ReplaceText.</p>
<p><img alt="NiFi" src="img/NiFiP2.7.png" /> </p>
<p>Le dedicamos unos minutos a entender el processor “<em>ReplaceText</em>” que propiedades 
nos aporta. 
Nota: Es recomendable revisar siempre antes de usar las propiedades disponibles y si 
es necesario, realizar alguna pequeña prueba.</p>
<p><img alt="NiFi" src="img/NiFiP2.8.png" /> </p>
<p>Queremos remplazar en el contenido del fichero generado por unos valores separados 
por comas. Y guardamos</p>
<p><img alt="NiFi" src="img/NiFiP2.9.png" /> </p>
<p>Para visualizar que es lo que pasa, vamos a añadir un processor “<em>log attribute</em>” y 
conectarlo sobre el processor “<em>ReplaceText</em>”. En esta conexión, debemos activar la 
casilla “<em>success</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP2.10.png" /> </p>
<p>Vamos a probar la generación del fichero y transformación de este. Le damos a “<em>Start</em>” 
con botón derecho sobre el processor “<em>GenerateFlowFile</em>”. Veremos que genera un 
fichero en la cola. Una vez lo genere, vamos a pararlo de la misma manera con la 
acción “<em>Stop</em>”. Ya que, si recordamos, lo hemos planificado para que se ejecute cada 5 
segundos. Si no, estará generando cada 5 segundos un nuevo fichero.</p>
<p><img alt="NiFi" src="img/NiFiP2.11.png" /> </p>
<p>En la cola, podemos validar el contenido generado, con botón derecho, “<em>List queue</em>”. Si 
damos al primer botón (columna), podremos ver/descargar el fichero generado.</p>
<p><img alt="NiFi" src="img/NiFiP2.12.png" /> </p>
<p>Si el processor os pone una alerta y no os deja arrancarlo. Es debido a que necesita 
que especifiquemos que hacer cuando falle. Cuando tenga éxito ira al processor 
conectado, pero cuando falle, que acción debe hacer. Vamos a propiedades, a 
relaciones y ahí lo podemos configurar</p>
<p><img alt="NiFi" src="img/NiFiP2.13.png" /> </p>
<p>Ahora ya le podemos dar la acción “Start” y ver que hace el “ReplaceText” que le 
hemos indicado al fichero de la cola. Podemos ir a la cola y validar que los ficheros se 
han convertido conforme lo esperado.</p>
<p><img alt="NiFi" src="img/NiFiP2.14.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP2.15.png" /> </p>
<p>Ahora vamos a añadir el processor “<em>ExtractText</em>” y en propiedades de este 
configuramos una nueva propiedad “<em>csv</em>” con una expresión regular “<em>(.+),(.+),(.+),(.+)</em>” 
de la siguiente manera:</p>
<p><img alt="NiFi" src="img/NiFiP2.16.png" /> </p>
<p>Ahora conectamos el “<em>ReplaceText</em>” con “<em>ExtractText</em>” eliminando la anterior relación 
con “<em>LogAttribute</em>”. Y luego, conectamos “<em>ExtractText</em>” con “<em>LogAttribute</em>”. En la 
definición de la relación, se ha de marcar el check “matched”. Como veis, el processor 
ExtractText tiene una alerta amarilla, quiere decir que no está del todo bien 
configurado. Pasa lo mismo que antes, es necesario añadir cuando la acción contraria a 
“match” que tiene que hacer. 
Vamos a propiedades de “<em>ExtractText</em>”, a “<em>Relationships</em>” y marcamos la acción 
“<em>terminate</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP2.17.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP2.18.png" /> </p>
<p>Llegado a este punto, le damos a la acción “<em>start</em>” del processor “<em>ExtractText</em>” y vemos 
como procesa el fichero con una salida en la cola. Podemos ver el resultado en la cola 
de nuevo como ha generado nuevos atributos según la expresión regular que le hemos 
aplicado, ya que el contenido en este caso no se ha visto modificado.</p>
<p><img alt="NiFi" src="img/NiFiP2.19.png" /> </p>
<p><strong>ENTREGABLE:</strong> Hay que exportar el template del proyecto y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P2_NomAlumnoApellidos.xml</em></p>
<h2 id="practica-3-expression-language">Práctica 3: Expression Language</h2>
<p>Partimos del resultado de la anterior practica 2, trabajando con atributos y contenido dónde 
generaremos primero un fichero aleatorio o con contenido personalizado, le aplicaremos 
alguna transformación y luego alteraremos en este sus propiedades. También veremos por los 
diferentes estados que pasa la ejecución y cómo ver en cada punto como va evolucionando el 
proceso.</p>
<p>El objetivo de esta práctica es modificar la solución de la practica 2, añadiendo un paso más al 
final, dónde utilizando Expression Language NiFi extraeremos información de los atributos de 
FlowFile que hemos creado para introducirlas en el contenido en formato JSON. Teniendo 
como resultado algo similar:</p>
<div class="language-text highlight"><pre><span></span><code>    {
    &quot;field1&quot;: &quot;a&quot;,
    &quot;field1&quot;: &quot;b&quot;,
    &quot;field1&quot;: &quot;c&quot;,
    &quot;field1&quot;: &quot;d&quot;
    }
</code></pre></div>
<p><img alt="NiFi" src="img/NiFiP3.1.png" /> </p>
<p>Añadimos un nuevo ReplaceText mediante el botón de Processor o duplicamos el que 
ya teníamos configurado para tener la misma configuración. Y lo conectamos entre el 
Processor “ExtractText” y terminando en el “LogAttribute”</p>
<p><img alt="NiFi" src="img/NiFiP3.2.png" /> </p>
<p>Una vez en este punto, nos queda configurar el “ReplaceText” añadido o duplicado, 
con la misma configuración que el primero, pero con la diferencia que en la propiedad 
“ReplacementValue” introducimos con Expression Language NiFi de dónde va a 
obtener los datos y que estructura va a tener para substituir el anterior contenido con 
el nuevo. El código es el siguiente, dónde referenciamos con el carácter “$” que es una 
propiedad del FlowFile.</p>
<div class="language-text highlight"><pre><span></span><code>    {
    &quot;field1&quot;: &quot;${csv.1}&quot;,
    &quot;field1&quot;: &quot;${csv.2}&quot;,
    &quot;field1&quot;: &quot;${csv.3}&quot;,
    &quot;field1&quot;: &quot;${csv.4}&quot;
    }
</code></pre></div>
<p><img alt="NiFi" src="img/NiFiP3.3.png" /> </p>
<p>Ejecutamos y podemos ver en la cola el resultado del contenido, si ha funcionado 
correctamente debe salir algo similar a la siguiente imagen:</p>
<p><img alt="NiFi" src="img/NiFiP3.4.png" /> </p>
<p><em>Nota: El Expression Language NiFi es muy útil y existen muchas funciones que es posible 
utilizarlas. Para ello recomendamos visitar la siguiente documentación y dedicarle unos 
minutos: Apache NiFi Expression Language Guide</em></p>
<p>Ahora vamos a continuar con el dataflow que hemos creado.
Si vamos a la cola final, y vemos los ficheros sus propiedades podemos ver que existen 
las propiedades de UID y Filename, que son valores únicos. Estos identifican de forma 
única el fichero dentro del dataflow y es posible utilizarlos para referenciar el FlowFile.
Por ejemplo, vamos a añadir un Processor “PutFile” y lo conectaremos entre el último 
replaceText y el log. Luego entraremos en las propiedades del PutFile y 
configuraremos el directorio dónde quedamos que se guarde el fichero.</p>
<p><img alt="NiFi" src="img/NiFiP3.5.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP3.6.png" /> </p>
<p>Arrancamos todos los procesos para generar un fichero y que llegue hasta la cola del 
log y veamos que pasa en el directorio. Confirmamos que el nombre del fichero lo coge 
de la propiedad de Filename del FlowFile.</p>
<p><img alt="NiFi" src="img/NiFiP3.7.png" /> </p>
<p>Vamos a añadir un Processor para actualizar el atributo y poner un nombre a los 
ficheros de salida (en la propiedad). El Processor a añadir es “<em>UpdateAttribute</em>”. Y 
vamos a propiedades y añadimos una nueva “<em>Filename</em>”. Y introducimos el valor 
siguiente:</p>
<div class="language-text highlight"><pre><span></span><code>    ${filename}-${now():toNumber():format(&#39;dd-MM-yy&#39;)}.json
</code></pre></div>
<p><img alt="NiFi" src="img/NiFiP3.8.png" /> </p>
<p>Ya solo quedaría conectar el Processor antes del PutFile para que le dé tiempo a 
cambiarle la propiedad. Y volvamos a revisar la salida a ver qué pasa.</p>
<p><img alt="NiFi" src="img/NiFiP3.9.png" /> </p>
<p>Hagamos como ejercicio, que el fichero de salida salga con el siguiente formato dónde 
lo siguiente a la fecha son horas, minutos y segundos:</p>
<p><img alt="NiFi" src="img/NiFiP3.10.png" /></p>
<p><strong>ENTREGABLE:</strong> Hay que exportar la practica con un Processor Group que genera un .json y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P3_NomAlumnoApellidos.xml</em></p>
<h2 id="practica-4-process-group-input-output-port">Práctica 4: Process group, Input-Output port</h2>
<p>En NiFi uno o más processor son conectados en un process group. Podemos añadir un 
process group arrastrando el icono de la barra de herramientas .
Partiendo de la practica 3. 
Cogemos y añadimos un nuevo process group y le ponemos como nombre “CSV to JSON” (<em>es posible obviar este paso, si ya se ha puesto la anterior practica en un process group, duplicandolo y renombrandolo a CSV to JSON</em>)
Para decirle como usar los processor’s, debemos seleccionar todos los processor (con 
la tecla shift) y arrastrarlos sobre el process group</p>
<p><img alt="NiFi" src="img/NiFiP4.1.png" /> </p>
<p>Para ver los componentes de un Process Group, hacemos doble click y accedemos al 
detalle. </p>
<p><img alt="NiFi" src="img/NiFiP4.2.png" /> </p>
<p>Para salir fuera del detalle, con botón derecho “<em>leave group</em>” saldremos de nuevo 
fuera.</p>
<p><em>Nota: Es recomendable utilizar los Process Group para lógicas complejas. Es posible duplicar un 
process group heredando la misma configuración.</em></p>
<p><img alt="NiFi" src="img/NiFiP4.3.png" /> </p>
<p>A veces, un Process Group puede generar una salida para utilizar en otros procesos. 
Vamos a transferir información des de un Process Group a otro. Para ello vamos a 
utilizar de la barra de herramientas el “<em>input</em>” y el “<em>output</em>” port .
El actual flujo de datos, lo vamos a partir en dos Process Group de la siguiente manera:
Creamos un nuevo Process Group que se llame “<em>Write JSON to File System</em>” dónde 
vamos a introduir los processors des de el “<em>UpdateAttribute</em>” hasta el último 
“<em>LogAttribute</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP4.4.png" /> </p>
<p>Cómo ya tenemos un process group principal “<em>CSV to JSON</em>”, vamos a sacar el 
process group “<em>Write JSON to File System</em>” fuera para poder ejecutarlos 
conjuntamente. Para ello hacemos botón derecho sobre “<em>Write JSON to File 
System</em>” y seleccionamos “<em>Move to parent group</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP4.5.png" /> </p>
<p>Ahora el problema está en que los dos processor group es necesario que se 
comuniquen para que funcionen. Para ello haremos uso del Input/Output port.
Accedemos al process group “<em>CSV to JSON</em>” y añadimos un “<em>Output port</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP4.6.png" /> </p>
<p>Salimos del grupo y accedemos ahora al Process Group “<em>Write JSON to CSV</em>” y 
añadimos un “<em>Input port</em>” al inicio</p>
<p><img alt="NiFi" src="img/NiFiP4.7.png" /> </p>
<p>Salimos al flujo principal, dónde ahora vamos a conectar los dos Process Group. Saldrá 
el mapeo de entradas y salidas, hay que tenerlo en cuenta cuando tengamos más de 
una entrada/salida que este bien asociado.
Ahora solo queda arrancar con botón derecho “<em>start</em>” y validar que todo funciona 
correctamente.</p>
<p><em>Nota: Dentro de un mismo Process Group no es posible conectar un “</em>Output port<em>” a un “</em>Input 
port<em>”.</em></p>
<p><strong>ENTREGABLE:</strong> Hay que exportar la practica con un Processor Group que genera un .json y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P4_NomAlumnoApellidos.xml</em></p>
<h2 id="practica-5-templates">Práctica 5: Templates</h2>
<div class="language-text highlight"><pre><span></span><code>            *Esta práctica queda descartada. Dado que en la versión M2 NiFi ya no se trabaja con los Templates si no con el Registry, exportando los trabajos a través de un Processor Group, pero si en versiones anteriores. Tenedlo en cuenta dado que si trabajais en versiones anteriores es la forma de guardar y exportar el trabajo realizado.*
</code></pre></div>
<p>Para guardar el trabajo realizado, exportarlo, etc usaremos los “Templates”.
Para ello debemos seleccionar todos los componentes a guardar en el template, y 
buscar el icono crear template que encontrareis en la izquierda.</p>
<p><img alt="NiFi" src="img/NiFiP5.1.png" /> </p>
<p>Le pondremos por ejemplo “<em>CSV to JSON</em>” y lo creamos.</p>
<p><img alt="NiFi" src="img/NiFiP5.2.png" /> </p>
<p>Hacemos click en “<em>Create</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP5.3.png" /> </p>
<p>Este template se almacena en la instancia local.
Si queremos ver todos los templates que tenemos creados en nuestra instancia local, 
tenemos que ir al botón de la derecha arriba y hacer clic en “<em>Templates</em>” dónde 
saldrá un listado. Dónde a la derecha aparece los botones para descargarlos para 
una futura importación o copia de seguridad.</p>
<p><img alt="NiFi" src="img/NiFiP5.4.png" /> </p>
<p><em>Nota: Existen templates de ejemplo que podemos descargar e importar a nuestra instancia
local para practicar o utilizar para un desarrollo. Lo podéis encontrar en el siguiente enlace: 
https://cwiki.apache.org/confluence/display/nifi/example+dataflow+templates</em></p>
<p>Vamos a acceder a la anterior página web y descargar un template. Por ejemplo, el 
“<em>Retry Count Loop</em>”.
Nos quedaría ahora importarlo a nuestro entorno de desarrollo. Accedemos al botón 
“<em>Upload Template</em>” y seleccionamos el fichero descargado “Retry_Count_Loop.xml” a 
través del icono .
Ahora para utilizarlo o revisar, sólo debemos ir a la barra de herramientas y 
seleccionar “<em>Add Template</em>” y arrastrar al espacio de trabajo. Seleccionamos el 
template descargado y veréis que aparece un nuevo Process Group.</p>
<p><img alt="NiFi" src="img/NiFiP5.5.png" /> </p>
<p>El cual, si hacemos doble clic, nos aparecerán todos los processor que tiene este 
Process Group. </p>
<p><strong>ENTREGABLE:</strong> Hay que exportar la practica con un Processor Group que genera un .json y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P5_NomAlumnoApellidos.xml</em></p>
<p><img alt="NiFi" src="img/NiFiP5.6.png" /> </p>
<h2 id="practica-6-funnel">Práctica 6: Funnel</h2>
<p>Combinar datos de varias conexiones en una sola
Vamos a revisarlo de forma rápida, se trata de como coger varias fuentes de datos y 
pasarlas por un solo componente para llegar a otro componente.
Añadimos dos processor “<em>GenerateFlowFile</em>” a una nueva hoja de trabajo.
Añadimos un “<em>Funnel</em>” des de la barra de herramientas
Añadimos un processor “<em>LogAttribute</em>”
Enlazamos los dos processor “<em>GenerateFlowFile</em>” al “<em>Funnel</em>”
Y el “<em>Funnel</em>” lo enlazamos con el ”<em>LogAttribute</em>”</p>
<p><img alt="NiFi" src="img/NiFiP6.1.png" /> </p>
<p><strong>ENTREGABLE:</strong> Hay que exportar la practica con un Processor Group que genera un .json y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P6_NomAlumnoApellidos.xml</em></p>
<h2 id="practica-7-controller-services">Práctica 7: Controller Services</h2>
<p>Los Controller Services son servicios compartidos que pueden ser usados con los processor o con otros controller 
services.</p>
<p>Vamos a realizar el siguiente caso de uso para validar esta funcionalidad.</p>
<p>Añadimos un nuevo processor “<em>FlowFileGenerator</em>”. Lo configuramos para que genere 
un fichero cada 10 segundos y en propiedades en el CustomText le ponemos lo 
siguiente:</p>
<div class="language-text highlight"><pre><span></span><code>    {
    &quot;title&quot;: &quot;mr&quot;,
    &quot;first&quot;: &quot;John ${random():mod(10):plus(1)}&quot;,
    &quot;last&quot;: &quot;Doe ${random():mod(10):plus(1)}&quot;,
    &quot;email&quot;: &quot;johndoe${random():mod(10):plus(1)}nail.com&quot;,
    &quot;created_on&quot;: &quot;${now():toNumber()}&quot;
    }
</code></pre></div>
<p><img alt="NiFi" src="img/NiFiP7.1.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP7.2.png" /> </p>
<p>Añadimos un processor “LogAttribute” y conectamos el “<em>FlowFileGenerator</em>” al 
“<em>LogAttribute</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP7.3.png" /> </p>
<p>Ahora vamos a ejecutar el proceso y validar que funciona correctamente viendo el 
contenido del fichero generado</p>
<p><img alt="NiFi" src="img/NiFiP7.4.png" /> </p>
<p>Añadimos un processor “<em>PutSQL</em>” para mandar este contenido generado a una 
tabla de base de datos.</p>
<p><em>Nota: Necesitamos tener una base de datos simple para hacer esta práctica ya sea en local o 
remota, por ejemplo, un PostgreSQL.</em></p>
<p>Para llegar a tener en formato SQL el contenido del JSON. Antes necesitamos 
convertirlo de formato. Para ello usaremos el processor “<em>ConvertJSONToSQL</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP7.5.png" /> </p>
<p>Vamos a configurar el processor “<em>ConvertJSONToSQL</em>”. Primero hay que configurar un 
nuevo “<em>Controller Service</em>”. De la siguiente manera:
        o Table Name: tbl_users
        o Statment Type: INSERT
        o JDBC Connection Pool: </p>
<p>Aquí es necesario crear un nuevo “<em>Controller Services</em>” seleccionando 
“Create Controller Services” dónde en este caso vamos a seleccionar 
“<em>DBCPConnectionPool</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP7.6.png" /> </p>
<p>Ahora faltaría configurar las propiedades de este “<em>Controller Service</em>” 
que hemos creado para introducir los datos de la conexión a la base de 
datos. Haciendo clic en la flecha que sale a la derecha.</p>
<p><img alt="NiFi" src="img/NiFiP7.7.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP7.8.png" /> </p>
<p>Hacemos clic en el botón de configuración y cuando salga la ventana vamos a 
propiedades y rellenamos las siguientes:</p>
<div class="language-text highlight"><pre><span></span><code>    o Connection URL: jdbc:postgresql://127.0.0.1:5432/postgres
    o Driver class name: org.postgresql.Driver
    o Driver Location: dónde tengamos el postgresql-42.2.25.jar 
    o Database User: xxxxxxxxxxx
    o Password: xxxxxxxxx
</code></pre></div>
<p><img alt="NiFi" src="img/NiFiP7.9.png" /> </p>
<p>Aplicamos cambios y activamos la conexión</p>
<p><img alt="NiFi" src="img/NiFiP7.10.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP7.11.png" /> </p>
<p>La estructura de la tabla destino es la siguiente</p>
<p><img alt="NiFi" src="img/NiFiP7.12.png" /> </p>
<p>Volvemos al espacio de trabajo y conectamos el processor “<em>ConverJSONtoSQL</em>” al 
“<em>PutSQL</em>” y configuramos el tipo de relación que tendrán, en este caso “<em>sql</em>”</p>
<p><img alt="NiFi" src="img/NiFiP7.13.png" /> </p>
<p>Pero también queremos mantener el fichero convertido, por tanto, añadiremos un 
nuevo proceso “<em>LogAttribute</em>” que conectaremos el “<em>ConvertJSONtoSQL</em>” a este y 
seleccionaremos la relación “<em>original</em>”. Esto nos valdrá de traza. También en el 
processor “<em>ConverJSONToSQL</em>” es necesario configurar la relación que cuando falle 
termine en ese punto.</p>
<p><img alt="NiFi" src="img/NiFiP7.14.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP7.15.png" /> </p>
<p>Y ejecutamos para ver qué es lo que hace en las dos colas. En una podemos ver el 
fichero original y en otra la traducción a una sentencia INSERT sql. Como podéis ver es 
necesario especificar los valores del insert a través de los atributos, como podéis ver 
en las siguientes imágenes ya que los valores del FlowFile generado (JSON) los deja en 
los atributos para que puedan ser usados</p>
<p><img alt="NiFi" src="img/NiFiP7.16.png" /> </p>
<p><img alt="NiFi" src="img/NiFiP7.17.png" /> </p>
<p>Nos queda ir al processor “<em>PutSQL</em>” y configurar que tenga bien puesto el jdbc 
(controller services) que hemos creado anteriormente.
Unir el processor “<em>PutSQL</em>” con el “<em>LogAttribute</em>” cuando tenga éxito.
Sobre el mismo connector “<em>PutSQL</em>” establecer una relación de que vuelva a intentarlo 
si falla “<em>Retry</em>”.</p>
<p><img alt="NiFi" src="img/NiFiP7.18.png" /> </p>
<p>Activamos todo el workflow y validamos en las colas que todo funciona. Como última 
comprobación, revisamos la tabla de la base de datos y veamos que los datos se estén
insertando</p>
<p><img alt="NiFi" src="img/NiFiP7.19.png" /> </p>
<p><strong>ENTREGABLE:</strong> Hay que exportar el template del proyecto y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P7_NomAlumnoApellidos.xml</em></p>
<h2 id="practica-8-variables">Práctica 8: Variables</h2>
<p>Las variables pueden ser usadas de dos formas:
En la ventana de la interfa de NiFi
En un fichero de configuración el cual referimos a través de “<em>nifi.propierties</em>”.
Vamos a crear un fichero de configuración llamado “<em>db.propierties</em>” y añadiremos 
todas las propiedades que en la practica 7 hemos usado para la configuración del 
Controller Service con la base de datos.</p>
<div class="language-text highlight"><pre><span></span><code>    o postgres.uri=jdbc:postgresql://127.0.0.1:5432/postgres
    o postgres.driverclassname=org.postgresql.Driver
    o postgres.driverpath= D:/NiFi/Practicas/practica7/postgresql-42.2.25.jar
    o postgres.username=postgres
    o postgres.password=nifi
</code></pre></div>
<p><img alt="NiFi" src="img/NiFiP8.1.png" /> </p>
<p>Ahora buscamos el fichero de configuración de NiFi llamado “<em>nifi.properties</em>” en el 
directorio “<em>conf</em>” y lo editamos. Búscamos “<em>registry</em>” y configuramos la variable que 
estará vacía en la ubicación del fichero que hemos creado “<em>db.properties</em>” que lo 
vamos a ubicar en el mismo directorio conf.</p>
<p><img alt="NiFi" src="img/NiFiP8.2.png" /> </p>
<p><em>Nota: Si tenemos más de un fichero de configuración, lo pondríamos separado por “,”.</em></p>
<p>Ahora para aplicar los cambios, es necesario reiniciar la instancia de NiFi. Control + c 
para cerrar la ventana de lanzamiento del proceso. Si se trata de sistema operativo 
Linux /nifi.sh stop , /nifi.sh start</p>
<p><img alt="NiFi" src="img/NiFiP8.3.png" /> </p>
<p>Una vez hemos vuelto a arrancar NiFi, nos vamos al processor ConvertJSONtoSQL, a 
propiedades y vamos con la flecha a la configuración del JDBC Connection Pool dónde 
debemos deshabilitar el Controller Service</p>
<p><img alt="NiFi" src="img/NiFiP8.4.png" /> </p>
<p>Ya deshabilitado, podemos ir a la configuración del Controller Service y vamos a usar 
Expression Language en las propiedades para especificar los parámetros definidos en 
el fichero que hemos cargado en el arranque de NiFi. Son los siguientes:</p>
<div class="language-text highlight"><pre><span></span><code>    o Database Connection URL: ${postgres.uri}
    o Database Driver Class Name: ${postgres.driverclassname}
    o Database Driver Location: ${postgres.driverpath}
    o Database User: ${postgres.username}
    o Database Password: ${postgres.password}
</code></pre></div>
<p>Aplicamos los cambios y volvemos a activar el Contoller Service para validar que 
funciona todo correctamente.</p>
<p><img alt="NiFi" src="img/NiFiP8.5.png" /> 
<img alt="NiFi" src="img/NiFiP8.6.png" /> </p>
<p>Ejecutamos y comprobamos que todos los pasos funcionan según lo esperado y que 
llegamos a insertar en la base de datos, por ejemplo, revisando la fecha de creación.
Cómo hemos comentado hay dos opciones de utilizar variables. Ya hemos visto la primera que 
es utilizando ficheros de propiedades que se cargan cuando arranca NiFi. Ahora vamos a ver la 
otra opción.</p>
<p><img alt="NiFi" src="img/NiFiP8.7.png" /> </p>
<p>Básicamente se hace en la hoja de trabajo, con botón derecho aparece la opción 
“<em>Variables</em>”. Hacemos clic y nos aparece una ventana para definirlas. Estas variables 
son definidas directamente.</p>
<p><img alt="NiFi" src="img/NiFiP8.8.png" /></p>
<p>Se referencian de la misma manera que las que se cargan con NiFi. </p>
<p><em>Nota: Es más ventajoso usar las variables definidas directamente ya que no necesitan 
reiniciar NiFi, además que ayuda a corregir posibles errores de manera rápida y también 
evitarlos.</em></p>
<p><strong>ENTREGABLE:</strong> Hay que exportar el template del proyecto y entregarlo en Aules con el número de la práctica y el nombreApellidos. Por ejemplo:  <em>P8_NomAlumnoApellidos.xml</em></p>
<h2 id="caso-de-uso-con-api">Caso de uso con API</h2>
<p><strong>Consulta de una API con NiFi</strong></p>
<p>En la práctica anterior sobre la API del INE, consultamos la encuesta de población activa. Vamos a continuar con esta práctica leyendo los datos con NiFi.</p>
<p>Recordemos que es necesario averiguar el código para realizar esta consulta, que nos devolverá un JSON:  </p>
<p><a href="http://servicios.ine.es/wstempus/js/ES/DATOS_SERIE/&lt;cod serie&gt;?nult=&lt;num dades&gt;">http://servicios.ine.es/wstempus/js/ES/DATOS_SERIE/<cod serie>?nult=<num dades></a></p>
<p><strong>Ejercicio:</strong></p>
<ol>
<li>
<p>Crea un pipeline que tome el JSON y lo guarde en un archivo en el sistema.</p>
</li>
<li>
<p>Haz que el pipeline aplane el JSON y lo guarde como un archivo CSV.</p>
</li>
<li>
<p>Configura el pipeline para tomar el JSON aplanado y guardarlo en una base de datos PostgreSQL.</p>
</li>
<li>
<p>Guarda este pipeline como una plantilla (template) para utilizarlo en futuros proyectos.</p>
</li>
</ol>
<h2 id="caso-de-uso-con-postgresql">Caso de uso con PostgreSQL</h2>
<p>Dadas las intensas temperaturas que se están dando estos últimos meses de 2022, 
necesitamos analizar y comparar con los años 2020 y 2021 de manera mensual la temperatura 
media y la acumulación de lluvia. Para ello vamos a necesitar obtener como fuentes de 
información del INE la relación de provincias y municipios de España, del AEMET la relación de 
datos meteorológicos de todas las estaciones de España y generar un catálogo de fechas.
Los datos que obtenemos de las diferentes fuentes de datos, los vamos a volcar en una base 
de datos ‘Definir qué base de datos, p.e. PostgreSQL’ en una capa de tablas Staging, para 
descargar los sistemas origen. </p>
<p>Luego realizaremos los tratamientos necesarios y los volcaremos 
a las capas finales en la base de datos, a los catálogos/dimensiones y estrella (ods).
Ya preparado el modelo multidimensional, tenemos dos opciones según tiempo: generar un
agregado sobre la capa ods con cálculos (kpi’s) ya hechos para agilizar la lectura de la 
aplicación de reporting o directamente pasar a la herramienta de reporting a 
pintar/analizar/calcular kpis.
Sacar conclusiones a través de la herramienta de reporting con tablas, informes y gráficos.</p>
<p>Anexo
Fechas
Añadir fuente/consulta sql para añadir datos del catálogo fecha.</p>
<p><a href="https://www.ine.es/daco/daco42/codmun/22codmun.xlsx">INE: Relación Provincia-Municipio</a></p>
<p>AEMET
Es necesario pedir una Api Key
<a href="https://opendata.aemet.es/centrodedescargas/docs/FAQs170621.pdf">https://opendata.aemet.es/centrodedescargas/docs/FAQs170621.pdf</a></p>
<p><a href="https://opendata.aemet.es/centrodedescargas/inicio">https://opendata.aemet.es/centrodedescargas/inicio</a></p>
<p><a href="https://opendata.aemet.es/dist/index.html?#!/valoresclimatologicos/Climatolog%C3%ADas_diarias">https://opendata.aemet.es/dist/index.html?#!/valoresclimatologicos/Climatolog%C3%ADas_diarias</a></p>
<p>Herramientas para desarrolladores 
Servicio web datos diarios estación meteorológica de todas las estaciones, entre ellas, Xativa.</p>
<p><img alt="NiFi" src="img\casousoapinifi.png" /> </p>
<p>Nos devuelve un JSON.</p>
<h2 id="caso-de-uso-con-mongodb">Caso de uso con MongoDB</h2>
<p><em>Por definir</em></p>
<h2 id="caso-de-uso-con-hadoop">Caso de uso con Hadoop</h2>
<p><strong>Traspaso de archivos FS y volcado a HDFS</strong></p>
<p>Debemos transferir una gran cantidad de archivos del sistema de la máquina virtual Linux al sistema de archivos de Hadoop HDFS, también localizado en la misma máquina virtual. Para evitar generar un script con muchas instrucciones como <code>hdfs dfs -put ...</code>, lo cual podría ser tedioso, implementaremos un proceso en NiFi que automatice esta tarea. Una vez que los archivos estén en el sistema HDFS, será necesario implementar un proceso para devolver estos archivos desde el sistema de archivos HDFS al sistema de archivos local. Este proceso permitirá automatizar esta tarea y realizarla periódicamente.</p>
<p><strong>Consideraciones:</strong></p>
<ul>
<li>
<p>NiFi debe ubicarse en el directorio <code>/opt</code>, al igual que Hadoop. Como usuario root, copiarlo. Eliminar el archivo zip de NiFi para liberar espacio en el disco duro de la máquina virtual.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="o">[</span>root@nodo1<span class="w"> </span>opt<span class="o">]</span><span class="c1"># cp -R /home/hadoop/Descargas/nifi-1.23.2 nifi</span>
</span></code></pre></div>
</li>
<li>
<p>Asegurar que el directorio de NiFi (<code>/opt/nifi</code>) tenga permisos de ejecución para que NiFi y Hadoop puedan interactuar.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="o">[</span>root@nodo1<span class="w"> </span>opt<span class="o">]</span><span class="c1"># chown -R hadoop:hadoop nifi</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="o">[</span>root@nodo1<span class="w"> </span>opt<span class="o">]</span><span class="c1"># chmod -R 777 nifi</span>
</span></code></pre></div>
</li>
<li>
<p>Si el directorio en HDFS al que enviamos los archivos no existe, el proceso debe crearlo.</p>
</li>
<li>
<p>NiFi debe tener permisos sobre HDFS.</p>
</li>
<li>
<p>Los directorios en HDFS deben tener permisos para que NiFi pueda escribir en ellos.</p>
</li>
</ul>
<p><strong>Pasos a seguir:</strong></p>
<ol>
<li>
<p>Crear un directorio llamado <code>input</code> en el sistema de archivos de la máquina virtual Linux, donde se ubicarán los archivos que queremos trasladar al sistema HDFS.</p>
</li>
<li>
<p>Implementar y configurar el procesador correspondiente para leer los archivos de este directorio del sistema de archivos de Linux.</p>
</li>
<li>
<p>Este procesador recogerá todos los archivos del sistema de archivos de la máquina virtual en el directorio que hemos creado y los trasladará al sistema HDFS de Hadoop.</p>
</li>
<li>
<p>Implementar y configurar el procesador correspondiente para realizar un <code>put</code> de los archivos al sistema HDFS de Hadoop en un directorio llamado <code>output_hdfs</code>. Si el directorio no existe, el proceso deberá crearlo con los permisos del usuario que ejecuta (hadoop).</p>
</li>
<li>
<p>Validar mediante el comando:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>hdfs<span class="w"> </span>dfs<span class="w"> </span>-ls<span class="w"> </span>/
</span></code></pre></div>
<p>en el sistema de archivos HDFS que el directorio se ha creado con los permisos correctos y que los archivos han llegado correctamente. También se puede validar utilizando la página web de HDFS: <a href="http://nodo1:9870/explorer.html">http://nodo1:9870/explorer.html</a>.</p>
</li>
<li>
<p>Añadir un nuevo procesador a NiFi que recoja los archivos del sistema HDFS del directorio <code>output_hdfs</code> y los traslade a un directorio <code>output</code> en el sistema de archivos Linux.</p>
</li>
</ol>
<p><strong>ENTREGA:</strong>: Un PDF con capturas de pantalla de todo lo implementado y de los resultados en los directorios, tanto en HDFS como en el sistema local.</p>
<p><strong>Ayuda:</strong> <a href="https://nifi.apache.org/docs.html">NiFi Documentation (apache.org)</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022- 2026
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://www.linkedin.com/in/jorsodom/" target="_blank" rel="noopener" title="Jorge Soro" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Consentimiento Cookie</h4>
<p>Utilizamos cookies para reconocer sus visitas repetidas y preferencias, así como para medir la eficacia de nuestra documentación y si los usuarios encuentran lo que buscan. Con su consentimiento, nos ayuda a mejorar nuestra documentación.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>