
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jorsodom.github.io/bigdata-sb/azure/AzurePractica1/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Conectar Raspberry Pi a Azure IoT - CES Big Data</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#conectar-raspberry-pi-a-azure-iot" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="CES Big Data" class="md-header__button md-logo" aria-label="CES Big Data" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CES Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Conectar Raspberry Pi a Azure IoT
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CES Big Data" class="md-nav__button md-logo" aria-label="CES Big Data" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CES Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/presentacions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Presentación
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UD1. Introducción
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            UD1. Introducción
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/BIIntroduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción BI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/analitica/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Análisis de datos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/ETLintroduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción ETL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduccionBI/tiposdedatos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tipos datos
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UD2. Entornos y modelado
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            UD2. Entornos y modelado
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multidimensional/entornos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tipos de entornos y arquitecturas de datos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../multidimensional/multidimensional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modelo multidimensional (OLAP)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objetivo" class="md-nav__link">
    <span class="md-ellipsis">
      Objetivo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p11-conectar-raspberry-pi-a-azure-centro-iot" class="md-nav__link">
    <span class="md-ellipsis">
      P1.1. Conectar Raspberry Pi a Azure Centro IoT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P1.1. Conectar Raspberry Pi a Azure Centro IoT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduccion" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-centro-iot" class="md-nav__link">
    <span class="md-ellipsis">
      Crear centro IoT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nuevo-dispositivo-iot" class="md-nav__link">
    <span class="md-ellipsis">
      Nuevo dispositivo IoT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulador" class="md-nav__link">
    <span class="md-ellipsis">
      Simulador
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejecucion-en-simulador" class="md-nav__link">
    <span class="md-ellipsis">
      Ejecución en simulador
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p12-conectar-raspberry-pi-a-azure-centro-iot-y-enrutamiento-a-una-cuenta-de-almacenamiento-storage-account" class="md-nav__link">
    <span class="md-ellipsis">
      P1.2. Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Cuenta de Almacenamiento (Storage Account)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="P1.2. Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Cuenta de Almacenamiento (Storage Account)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduccion_1" class="md-nav__link">
    <span class="md-ellipsis">
      Introducción
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conexion-con-dispositivo" class="md-nav__link">
    <span class="md-ellipsis">
      Conexión con dispositivo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-cuenta-de-almacenamiento-storage-account" class="md-nav__link">
    <span class="md-ellipsis">
      Crear cuenta de almacenamiento (Storage Account)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enrutamiento-a-una-cuenta-de-almacenamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Enrutamiento a una cuenta de almacenamiento
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supervision" class="md-nav__link">
    <span class="md-ellipsis">
      Supervisión
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualizacion-de-mensages-en-la-cuenta-de-almacenamiento" class="md-nav__link">
    <span class="md-ellipsis">
      Visualización de mensages en la cuenta de almacenamiento
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejercicio" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p13-conectar-raspberry-pi-a-azure-centro-iot-y-enrutamiento-a-una-aplicacion-logica-y-envio-de-correos" class="md-nav__link">
    <span class="md-ellipsis">
      P1.3. Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Aplicación Lógica y envío de correos
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="conectar-raspberry-pi-a-azure-iot">Conectar Raspberry Pi a Azure IoT</h1>
<h2 id="objetivo">Objetivo</h2>
<p>Vamos a conectar dispositivos a la nube sin ningún problema con Azure Centro IoT utilizando un simulador de Raspberry Pi.  </p>
<p><strong>¿Qué vamos a hacer?</strong>  </p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Crear un Centro IoT.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Registrar un nuevo dispositivo en el Centro IoT para conectarlo con la Raspberry Pi.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Configurar el simulador Raspberry Pi.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Ejecutar una aplicación de ejemplo en el simulador para enviar datos de un sensor al Centro IoT.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Recopilar datos del sensor al ejecutar el simulador IoT.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Conectar con una cuenta de almacenamiento (<em>Storage Account</em>), aplicaciones lógicas y envío de correos.  </li>
</ul>
<div align="center">
<img src="../../img/azurep1_1.png" alt="Azure p1" 
width="80%" />
</div>
<p>La <strong>práctica 1* se dividide en </strong>3 partes**:</p>
<ul>
<li>
<p><a href="https://jorsodom.github.io/bigdata-sb/azure/AzurePractica1/#p11-conectar-raspberry-pi-a-azure-centro-iot"><strong>P1.1.</strong> Conectar Raspberry Pi a Azure Centro IoT</a>  </p>
</li>
<li>
<p><a href="https://jorsodom.github.io/bigdata-sb/azure/AzurePractica1/#p12-conectar-raspberry-pi-a-azure-centro-iot-y-enrutamiento-a-una-cuenta-de-almacenamiento-storage-account"><strong>P1.2.</strong> Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Cuenta de Almacenamiento (Storage Account)</a>  </p>
</li>
<li>
<p><a href="https://jorsodom.github.io/bigdata-sb/azure/AzurePractica1/#p13-conectar-raspberry-pi-a-azure-centro-iot-y-enrutamiento-a-una-aplicacion-logica-y-envio-de-correos"><strong>P1.3.</strong> Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Aplicación Lógica y envío de correos</a>  </p>
</li>
</ul>
<h2 id="p11-conectar-raspberry-pi-a-azure-centro-iot">P1.1. Conectar Raspberry Pi a Azure Centro IoT</h2>
<h3 id="introduccion">Introducción</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Crearemos un "Azure Centro IoT".  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Registraremos un dispositivo para Raspberry Pi en Azure Centro IoT.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Configuraremos el simulador Raspberry Pi.  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Ejecutaremos una aplicación de ejemplo en la Raspberry Pi para enviar datos del sensor al Centro IoT Hub.  </li>
</ul>
<h3 id="crear-centro-iot">Crear centro IoT</h3>
<ul>
<li>Creamos un nuevo recurso <strong><em>*Centro de IoT</em></strong>*.</li>
</ul>
<div align="center">
<img src="../../img/azurep1_5.png" alt="Azure p1" 
width="80%"/>
</div>
<ul>
<li>Como no tenemos un recurso creado, vamos a generarlo para asignar todo a este recurso y así después encontrarlo más fácilmente.  </li>
</ul>
<div align="center">
<img src="../../img/azurep1_6.png" alt="Azure p1" 
width="80%"/>
</div>
<ul>
<li>Rellenamos los campos: <em>Suscripción, Grupo de recursos, nombre de la instancia, región y Nivel</em>. Después seleccionamos “<strong>Siguiente: Redes</strong>”.  </li>
</ul>
<div align="center"><img src="../../img/azurep1_7.png" alt="Azure p1" width="80%"/></div>
<ul>
<li>Seleccionamos “<em>Acceso público</em>”.  </li>
</ul>
<div align="center"><img src="../../img/azurep1_8.png" alt="Azure p1" width="80%"/></div>
<ul>
<li>Seleccionamos “<strong>Siguiente: Administración</strong>”. Lo dejamos por defecto. No tocamos ningún parámetro.  </li>
</ul>
<div align="center"><img src="../../img/azurep1_9.png" alt="Azure p1" width="80%" />
</div>
<ul>
<li>Seleccionamos “<strong>Siguiente: Etiquetas</strong>”. No introducimos nada. O, si deseas etiquetar el recurso, introduce el Nombre / Valor para luego buscar el recurso a través de la etiqueta.  </li>
<li>Seleccionamos “<strong>Siguiente: Revisar y crear</strong>”. Revisamos que todo esté correcto.  </li>
<li>Llegados a este punto, ya podemos crear el recurso Centro de IoT. Hacemos clic en “<strong>Create/Crear</strong>”. Tardará un tiempo en implementarse el recurso. Mientras tanto, en el espacio de notificaciones podemos observar el progreso hasta que finalice.  </li>
</ul>
<div align="center"><img src="../../img/azurep1_10.png" alt="Azure p1" width="80%" /></div>
<div align="center"><img src="../../img/azurep1_11.png" alt="Azure p1" width="80%" /></div>

<h3 id="nuevo-dispositivo-iot">Nuevo dispositivo IoT</h3>
<ul>
<li>En el menú de navegación del Centro de IoT, seleccionamos “<strong>Dispositivos</strong>” y luego seleccionamos “<strong>Agregar dispositivo</strong>”.  </li>
</ul>
<div align="center"><img src="../../img/azurep1_13.png" alt="Azure p1" width="80%" /></div>
<ul>
<li>En “<strong>Crear un dispositivo</strong>”, proporcionamos un nombre para el nuevo dispositivo, como por ejemplo: “<em>RaspberryInput</em>” y no es necesario modificar ningún otro parámetro.<em>Dejamos activada la opción “</em><em>Generar claves automáticamente</em><em>” para las claves primarias y secundarias, que se generan de forma automática.</em> Seleccionamos “<strong>Guardar</strong>”. Esta acción crea una nueva identidad del dispositivo para el Centro de IoT.</li>
</ul>
<div align="center"><img src="../../img/azurep1_14.png" alt="Azure p1" width="80%" /></div>
<ul>
<li>Después de crear el dispositivo, lo abrimos desde la lista del panel de <em>Dispositivos</em>.  </li>
</ul>
<div align="center"><img src="../../img/azurep1_15.png" alt="Azure p1" width="80%" /></div>
<ul>
<li>Copiamos la “<strong>Cadena de conexión principal o String</strong>” (<em>el código del dispositivo utiliza esta cadena de conexión para comunicarse con el Centro IoT</em>).  </li>
</ul>
<div align="center"><img src="../../img/azurep1_16.png" alt="Azure p1" width="80%" /></div>

<div class="admonition note">
<p class="admonition-title">Nota</p>
<ul>
<li>De forma predeterminada, las claves y las cadenas de conexión están enmascaradas porque son información confidencial. Si se hace clic en el ícono del ojo, se muestran. No es necesario mostrarlas para copiarlas.</li>
</ul>
</div>
<h3 id="simulador">Simulador</h3>
<div align="center">
<img src="../../img/azurep1_4.png" alt="Azure p1" 
width="80%" />
</div>
<ul>
<li><strong>Enlace</strong>: <a href="https://azure-samples.github.io/raspberry-pi-web-simulator/#GetStarted">Raspberry Pi Azure IoT Web Simulator</a></li>
</ul>
<p>Hay tres áreas en este simulador:  </p>
<ul>
<li>
<p><strong>Circuito</strong>: El circuito predeterminado consiste en una Raspberry Pi conectada a un sensor BME280 y un LED. No se puede modificar.  </p>
</li>
<li>
<p><strong>Área de codificación</strong>: Un editor de código en línea para programar con Raspberry Pi. La aplicación de ejemplo predeterminada permite recopilar datos del sensor BME280 y enviarlos a Azure IoT Hub. La aplicación es totalmente compatible con dispositivos reales. </p>
</li>
<li>
<p><strong>Ventana de consola integrada</strong>: Muestra la salida del código. En la parte superior aparecen tres botones: </p>
<div class="language-text highlight"><pre><span></span><code>- **Run (Ejecutar)**: Ejecuta la aplicación en el área de codificación.  
- **Reset (Restablecer)**: Restablece el área de codificación a la aplicación de ejemplo predeterminada.  
- **Fold/Expand (Comprimir/Expandir)**: A la derecha hay un botón para plegar o expandir la ventana de la consola.
</code></pre></div>
</li>
</ul>
<h3 id="ejecucion-en-simulador">Ejecución en simulador</h3>
<ul>
<li>Sobre el código por defecto del simulador web, <strong>modificamos</strong> la linia 15 dónde pone "<em>Your IoT hub device connection string</em>" para la cadena de conexión que hemos generado en Azure IoT Hub antes.</li>
</ul>
<div align="center"><img src="../../img/azurep1_2.png" alt="Azure p1" width="80%" /></div>
<ul>
<li>Seleccionar "<strong>Ejecutar</strong>" o escribir "<strong>npm start</strong>" para ejecutar.
Debemos de revisar el resultado del sensor y los mensajes generados.</li>
</ul>
<div align="center"><img src="../../img/azurep1_3.png" alt="Azure p1" width="80%" /></div>

<h2 id="p12-conectar-raspberry-pi-a-azure-centro-iot-y-enrutamiento-a-una-cuenta-de-almacenamiento-storage-account">P1.2. Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Cuenta de Almacenamiento (Storage Account)</h2>
<h3 id="introduccion_1">Introducción</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Creamos una cuenta de almacenamiento "Blob Storage Account".</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Creamos un punto de conexión personalizado para que la cuenta de almacenamiento enrute los mensajes desde el Centro IoT.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Revisamos los mensajes del dispositivo en el "Blob Storage Account".</li>
</ul>
<h3 id="conexion-con-dispositivo">Conexión con dispositivo</h3>
<p>Acopiado este punto, vamos a recuperar los mensajes recibidos en el Azure Centre IoT a través de un componente de Azure llamado "enrutamiento de mensajes" para almacenarlos en una Storage Account para poder explotarlos posteriormente.</p>
<ol>
<li>Vamos al Azure Centro IoT en el portal Azure.</li>
<li>Seleccionamos "<strong>Directivas de acceso compartido</strong>" en la sección "<em>Configuración de seguridad</em>".</li>
<li>Seleccionamos la directiva "<strong>iothubowner</strong>".</li>
<li>Copiamos el contenido de la "<em>cadena de conexión principal / string</em>"</li>
<li>Ahora utilizaremos esta cadena de conexión para configurar el Explorador del Centro IoT. Hay que descargar e instalar el herramiento: <a href="https://github.com/Azure/azure-iot-explorer/releases">Releases · Azure/azure-iot-explorer (github.com)</a><div class="language-text highlight"><pre><span></span><code>-       Abrimos el aplicativo &quot;**Azure IoT Explorer**&quot;.
-       Seleccionamos &quot;**Connect via IoT Hub connection string**&quot;. Y añadimos un nuevo dispositivo.
-       Peguemos la cadena de conexión copiada anteriormente (iothubowner)
-       Seleccionamos &quot;Guardar&quot;.
-       Ya conectados al Centro IoT, veremos un listado de los dispositivos. Seleccionamos lo creado.
-       Seleccionamos &quot;Telemetría&quot;.
-       Con el dispositivo en ejecución, seleccionamos &quot;Start&quot;. Si el dispositivo no se está ejecutando, no veremos la telemetría. 
-       h.  Si todo esta funcionando, debemos visualizar los mensages que llegan al dispoisitvo, el mas reciente en la parte superior.
-       Todos los mensajes reúnen al punto de conexión integrado predeterminado del Centro IoT. A continuación, vamos a crear un punto de conexión personalizado y enrutar algunos de los mensajes al conde de almacenamiento en función de las propiedades del mensaje.
</code></pre></div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Observación</p>
<div class="language-text highlight"><pre><span></span><code>Observem els missatges entrants durant uns segons per comprovar que veiem diferents paràmetres. Després, podem parar el dispositiu.
</code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<div class="language-text highlight"><pre><span></span><code>Los mensajes dejarán de aparecer en el Explorador IoT por que solo van al punto de conexión integrado cuando no coinciden con ninguna otra ruta en el Centro IoT
</code></pre></div>
</div>
<h3 id="crear-cuenta-de-almacenamiento-storage-account">Crear cuenta de almacenamiento (Storage Account)</h3>
<p>Creamos un "Storage Account" y un contenedor dentro que tendrá todos los mensajes del dispositivo que se asoman a la misma.</p>
<ol>
<li>Abrimos el Portal Azure y buscamos "Cuentas de almacenamiento"</li>
<li>Seleccionamos "Crear".</li>
<li>Proporcionamos los siguientes valores para la "Cuentas de almacenamiento": Suscripción, Grupos de recursos, Número del a cuenta de almacenamiento y Rendimiento.</li>
<li>Seleccionamos "Revisar y crear".</li>
<li>Una vez completada la validación, seleccionamos "Crear".</li>
<li>Una vez finalizada la implementación, seleccionamos "Ir al recurso" o lo buscamos a través del portal.</li>
<li>En el menú de la "cuenta de almacenamiento", seleccionamos "Contenedores en la sección Almacenamiento de datos".</li>
<li>Seleccionamos "+ Contenedor" para crear un nuevo contenedor.</li>
<li>Proporcionaremos un nombre para el contenedor y seleccionamos "Crear".</li>
</ol>
<h3 id="enrutamiento-a-una-cuenta-de-almacenamiento">Enrutamiento a una cuenta de almacenamiento</h3>
<p>Vamos a definir un nuevo punto de conexión que apunta a la "cuenta de almacenamiento" que me creado. 
A continuación, creamos una ruta sin ningún filtro a los mensajes y lo enrutamos en el punto de conexión de la "cuenta de almacenamiento"</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
</div>
<p>Se pueden escribir datos en el Blob Storage con formato Apache Avro (predeterminado) o JSON. El formato de codificación solo se puede establecer en el momento en el que se configura el punto de conexión del Blob Storage. No se puede cambiar el formato en un punto de conexión que ya está configurado. Cuando se utiliza codificación JSON, se debe establecer contentType en JSON y contentEncoding en UTF-8 en las propiedades del sistema de mensajes.</p>
<ol>
<li>En Azure Portal, vamos hasta el Centro IoT.</li>
<li>Seleccionamos "Enrutamiento de mensajes".</li>
<li>En la pestaña "Rutas", seleccionamos "+ Agregar".</li>
<li>Seleccionamos en "Agregar punto de conexión" junto al campo "Extremo" y seleccionamos "Almacenamiento" en el menu desplegable.</li>
<li>Proporcionamos la información para el nuevo punto de conexión: Número, Contenedor de Azure Storage y Encoding.</li>
<li>Aceptamos los valores predeterminados para el resto de parámetros y seleccionamos "Crear".</li>
<li>Seguimos con la creación de la nueva ruta. Hemos agregado el punto de conexión al "Storage Account". Proporcionaremos la siguiente información para la nueva ruta:</li>
<li>Guardamos
Una vez creada la ruta en el Centro IoT y habilitada, iniciará inmediatamente el derrumbamiento de mensajes que cumpliendo la condición de la consulta del punto de conexión definido.</li>
</ol>
<h3 id="supervision">Supervisión</h3>
<p>Volvamos a la sesión del explorador IoT. Recordemos que el explorador IoT supervisa el punto de conexión integrado para el centro IoT. Significa que ahora debería ver solo mensajes que no se enrutan mediante la ruta personalizada creada.
Volvemos a iniciar el simulador y la telemetría. Observamos los mensajes entrantes durante unos instantes (si hay)</p>
<h3 id="visualizacion-de-mensages-en-la-cuenta-de-almacenamiento">Visualización de mensages en la cuenta de almacenamiento</h3>
<p>Comprobamos los mensajes están apretando al "Storage account":</p>
<ol>
<li>En Azure Portal, vamos a "cuenta de almacenamiento".</li>
<li>Seleccionamos "Contenedores" en la sección de "Almacenamiento".</li>
<li>Seleccionamos el contenedor.</li>
<li>Debe haber una carpeta con el nombre del centro IoT. Exploramos en profundidad la estructura hasta que reúnamos a ficheros avro.</li>
<li>Seleccionamos el fichero avro y, a continuación, lo descargamos. Y confirmamos que contiene mensajes del dispositivo establecido en el "enrutamiento".</li>
<li>Paremos el simulador.</li>
</ol>
<h3 id="ejercicio">Ejercicio</h3>
<p>En el "enrutamiento" creado en el "Centro IoT" hacia el Storage Account, se pueden definir condiciones que filtran los mensajes que irán destinados al Storage Account.
Con la documentación de Microsoft: <a href="https://learn.microsoft.com/es-es/azure/iot-hub/iot-hub-devguide-routing-query-syntax">Consulta sobre el enrutamiento de mensajes de Azure IoT Hub | Microsoft Learn</a></p>
<p>Generar un filtro que destine solo mensajes filtrados por alguna de sus características del JSON devuelto.</p>
<h2 id="p13-conectar-raspberry-pi-a-azure-centro-iot-y-enrutamiento-a-una-aplicacion-logica-y-envio-de-correos">P1.3. Conectar Raspberry Pi a Azure Centro IoT y Enrutamiento a una Aplicación Lógica y envío de correos</h2>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022- 2026
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://www.linkedin.com/in/jorsodom/" target="_blank" rel="noopener" title="Jorge Soro" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Consentimiento Cookie</h4>
<p>Utilizamos cookies para reconocer sus visitas repetidas y preferencias, así como para medir la eficacia de nuestra documentación y si los usuarios encuentran lo que buscan. Con su consentimiento, nos ayuda a mejorar nuestra documentación.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>